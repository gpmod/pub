(function(){
class GPUtils_{static async compressImageData(a,b=!0){const {data:c,background:g,auth:f,meta:k}=a;a={m:{a:k.author,t:k.title,d:(new Date(k.date)).toISOString()},d:c};g&&(a.b=g);f&&(a.a=f);return b?this.wCompressData(a):this.compressData(a)}static async compressData(a){a=JSON.stringify(a);a=this.stringToArrayBuffer(a);a=await this.compressArrayBuffer(a);return this.arrayBufferToBlob(a)}static arrayBufferToBlob(a){return new Blob([a],{type:"octet/stream"})}static async compressArrayBuffer(a){var b=
new CompressionStream("deflate"),c=b.writable.getWriter();c.write(a);c.close();a=[];b=b.readable.getReader();for(c=0;;){const {value:g,done:f}=await b.read();if(f)break;a.push(g);c+=g.byteLength}b=new Uint8Array(c);c=0;for(const g of a)b.set(g,c),c+=g.byteLength;return b}static stringToArrayBuffer(a){return(new TextEncoder).encode(a)}static async decompressFile(a){return JSON.parse(await this.decompressBlob(a))}static async decompressBlob(a){let b=new DecompressionStream("deflate");a=a.stream().pipeThrough(b);
return await (new Response(a)).text()}static saveBlob(a,b=""){a=window.URL.createObjectURL(a);const c=document.createElement("a");c.href=a;c.download=b;c.click();window.URL.revokeObjectURL(a)}static wCompressData(a){return new Promise(b=>{const c=this.createWorker(this.compressWorkerBody);c.addEventListener("message",({data:g})=>{c.terminate();b(g)});c.postMessage(a)})}static compressWorkerBody(){self.work=new async function(){}.constructor("a",'a=JSON.stringify(a);a=(new TextEncoder).encode(a);var c=new CompressionStream("deflate"),b=c.writable.getWriter();b.write(a);b.close();a=[];c=c.readable.getReader();for(b=0;;){const {value:d,done:e}=await c.read();if(e)break;a.push(d);b+=d.byteLength}c=new Uint8Array(b);b=0;for(const d of a)c.set(d,b),b+=d.byteLength;return new Blob([c],{type:"octet/stream"})');
self.addEventListener("message",async({data:a})=>{self.postMessage(await self.work(a))})}static createWorker(a){a=URL.createObjectURL(new Blob([this.getFuncBody(a)]));const b=new Worker(a);URL.revokeObjectURL(a);return b}static getFuncBody(a){a=a.toString();return a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))}static setInputFocusBlurHandler(a){const b=c=>{c.target!==a&&(a.blur(),document.removeEventListener("pointerdown",b,!0))};a.addEventListener("focus",c=>{c.target.select();document.addEventListener("pointerdown",
b,!0)});a.addEventListener("blur",c=>{window.getSelection().removeAllRanges()})}}window.GPUtils_=GPUtils_;class GPTimelapsePlayer_ extends EventTarget{static players=new Set;static CACHE_ENABLE=!0;static CACHE_INTERVAL=1E3;static ORIGINAL_WIDTH=758;static ORIGINAL_HEIGHT=424;static DENSITY=1;static WIDTH=this.ORIGINAL_WIDTH*this.DENSITY;static HEIGHT=this.ORIGINAL_HEIGHT*this.DENSITY;static BACKGROUND_COLOR="#FFFFFF";static STROKE_OFFSET=3;static SPEEDS=[[1,1],[5,1],[15,1],[30,1],[50,1],[0,1],[0,2],[0,4],[0,8],[0,16],[0,32]];static SPEED=0;static SPEED_SLIDER_WIDTH=130;static SPEED_SLIDER_HEIGHT=16;static SPEED_SLIDER_THUMB_WIDTH=14;static M_STROKE_OFFSET=67;static DISPLAY_MODE={NORMAL:"normal",
EXPANDED:"expanded",FULLSCREEN:"fullscreen"};static DEFAULT_DISPLAY_MODE=GPTimelapsePlayer_.DISPLAY_MODE.NORMAL;static FV2_DATE=1681366233E3;constructor({image:{data:a,background:b,auth:c,meta:{author:g,title:f,date:k}},container:d,mainContainer:e},h=GPTimelapsePlayer_.DEFAULT_DISPLAY_MODE,l=!1){super();GPTimelapsePlayer_.players.add(this);this.density=GPTimelapsePlayer_.DENSITY;this.width=GPTimelapsePlayer_.WIDTH;this.height=GPTimelapsePlayer_.HEIGHT;this.originalData=a.slice();const [m,n,p]=this.handleDelimiters(a,
b);this.data=m;this.background=n;this.auth=c;this.author=g;this.title=f;this.date=new Date(k);this.eraserAlpha=!p;this.fi=k&&this.date.getTime()>GPTimelapsePlayer_.FV2_DATE?5:4;this.container=d;this.container.isPlayerRendered=!0;this.mainContainer=e;this.defaultDisplayMode=h;this.defaultDisplayModeDensity=this.getModeDensity(h);this.cache;this.canvas;this.ctx;this.isPlaying=!1;this.currentSpeed=JSON.parse(localStorage.getItem("gp-timelapse-player-speed"))||GPTimelapsePlayer_.SPEED;this.speed=GPTimelapsePlayer_.SPEEDS[this.currentSpeed];
this.sPos=this.pos=0;this.lastContainerDimension={width:0,height:0};this.isContextLayoutShown=this.isFullscreen=this.isExpanded=!1;this.isContextMenuDisabled=l;this.progressBarPointerMoveHandler=this.progressBarPointerMoveHandler.bind(this);this.resizeHandler=this.resizeHandler.bind(this);this.toggleFullscreen=this.toggleFullscreen.bind(this);this.playPause=this.playPause.bind(this);this.drawing=this.drawing.bind(this);this.expand=this.expand.bind(this);this.terminate=this.terminate.bind(this);this.toggleContextLayout=
this.toggleContextLayout.bind(this);this.saveImage=this.saveImage.bind(this);this.speedViewPointerMoveHandler=this.speedViewPointerMoveHandler.bind(this);window.addEventListener("resize",this.resizeHandler);this.addEventListener("cache-updated",this.updateCacheHandler);this.initData();this.initCacheWorker()}static closeAll(){GPTimelapsePlayer_.players.forEach(a=>{a.terminate()})}updateCacheHandler({detail:{density:a}}){if(a===this.defaultDisplayModeDensity){this.render();switch(this.defaultDisplayMode){case GPTimelapsePlayer_.DISPLAY_MODE.EXPANDED:this.expand(!0);
break;case GPTimelapsePlayer_.DISPLAY_MODE.FULLSCREEN:this.player.requestFullscreen()}this.seek(this.data.length);this.dispatchEvent(new Event("image-rendered"));this.dispatchEvent(new CustomEvent("data-loaded",{detail:{author:this.author,title:this.title,date:this.date.toISOString()}}));this.removeEventListener("cache-updated",this.updateCacheHandler)}}getModeDensity(a){switch(a){case GPTimelapsePlayer_.DISPLAY_MODE.NORMAL:const {width:b,height:c}=getComputedStyle(this.container);return this.getDensityByDimensions(parseInt(b),
parseInt(c)).density;case GPTimelapsePlayer_.DISPLAY_MODE.EXPANDED:const {width:g,height:f}=getComputedStyle(this.mainContainer);return this.getDensityByDimensions(parseInt(g),parseInt(f)).density;case GPTimelapsePlayer_.DISPLAY_MODE.FULLSCREEN:return this.getDensityByDimensions(window.screen.width,window.screen.height).density}}terminate(){document.fullscreenElement===this.player&&this.mainContainer.classList.remove("gp-tp-fullscreen_");this.pause();this.worker.terminate();this.cache=this.originalData=
this.data=null;this.player.remove();this.container.isPlayerRendered=!1;this.container=null;this.speedInput&&this.speedInput.remove();window.removeEventListener("resize",this.resizeHandler);GPTimelapsePlayer_.players.delete(this);this.dispatchEvent(new Event("terminated"))}initData(){const a=[];for(let b=0;b<this.data.length;b++)this.data[b].index=b,this.isMStroke(this.data[b])&&a.push(b);a.reverse().forEach(b=>{this.data.splice(b,1)})}isMStroke(a){return!(1===a[0]&&a[3][0]>GPTimelapsePlayer_.ORIGINAL_WIDTH&&
a[3][1]>GPTimelapsePlayer_.ORIGINAL_HEIGHT)||a[3][0]-GPTimelapsePlayer_.ORIGINAL_WIDTH-GPTimelapsePlayer_.M_STROKE_OFFSET||a.at(-1)[1]-GPTimelapsePlayer_.ORIGINAL_HEIGHT-GPTimelapsePlayer_.M_STROKE_OFFSET?!1:!0}render(){this.player=document.createElement("div");this.player.className="timelapse-player_";this.player.addEventListener("click",f=>{f.stopPropagation()});this.player.addEventListener("pointerdown",f=>{f.stopPropagation()});this.player.addEventListener("pointerup",f=>{f.stopPropagation()});
this.player.addEventListener("mouseup",f=>{f.stopPropagation()});this.player.addEventListener("mousedown",f=>{f.preventDefault();f.stopPropagation();1===f.button&&(this.isFullscreen?this.toggleFullscreen():this.expand())},!0);this.player.addEventListener("contextmenu",f=>{f.stopPropagation();f.preventDefault();this.toggleContextLayout()});this.player.addEventListener("fullscreenchange",f=>{this.isFullscreen=!!document.fullscreenElement;this.player.classList.toggle("fullscreen_",this.isFullscreen);
this.mainContainer.classList.toggle("gp-tp-fullscreen_",this.isFullscreen);this.resizeHandler()});this.bgCanvas=document.createElement("canvas");this.bgCanvas.className="background-canvas_";this.bgCanvas.width=this.width;this.bgCanvas.height=this.height;this.player.appendChild(this.bgCanvas);this.bgCtx=this.bgCanvas.getContext("2d");this.bgCtx.fillStyle=GPTimelapsePlayer_.BACKGROUND_COLOR;this.bgCtx.fillRect(0,0,this.bgCanvas.width,this.bgCanvas.height);this.background&&this.drawFunction(this.bgCtx,
this.background,this.density,!1);this.canvas=document.createElement("canvas");this.canvas.className="canvas_";this.canvas.width=this.width;this.canvas.height=this.height;this.player.appendChild(this.canvas);this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0});this.strokeCanvas=document.createElement("canvas");this.strokeCanvas.className="stroke-canvas_";this.strokeCanvas.width=this.width;this.strokeCanvas.height=this.height;this.player.appendChild(this.strokeCanvas);this.strokeCtx=this.strokeCanvas.getContext("2d");
var a=document.createElement("div");a.className="event-catcher_";a.addEventListener("click",this.playPause);a.addEventListener("dblclick",this.toggleFullscreen);this.player.appendChild(a);a=document.createElement("div");a.className="controls_";a.style.cssText="";this.player.appendChild(a);const b=document.createElement("div");b.className="progress-bar_";b.addEventListener("pointermove",f=>{const [k,,d]=this.getCoords(f);g.style.width=`${100*Math.max(0,Math.min(1,k/d))}%`},!0);b.addEventListener("pointerdown",
f=>{if(0===f.button){var k=this.isPlaying;this.progress.classList.remove("smooth_");this.player.classList.toggle("finished_",this.pos===this.data.length-1);this.progressBarPointerMoveHandler(f);b.setPointerCapture(f.pointerId);b.addEventListener("pointermove",this.progressBarPointerMoveHandler);b.addEventListener("pointerup",d=>{b.removeEventListener("pointermove",this.progressBarPointerMoveHandler);this.progress.classList.add("smooth_");this.player.classList.toggle("finished_",this.pos===this.data.length);
k&&this.pos<this.data.length&&this.play()},{once:!0})}});a.appendChild(b);var c=document.createElement("div");c.className="progress-bar-bg_";b.appendChild(c);const g=document.createElement("div");g.className="progress-hover_";b.appendChild(g);this.progress=document.createElement("div");this.progress.className="progress_ smooth_";this.updateProgress();b.appendChild(this.progress);c=document.createElement("div");c.className="play-btn_ btn_";c.title="\u0417\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c/\u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0440\u043e\u0438\u0433\u0440\u044b\u0432\u0430\u043d\u0438\u0435";
a.appendChild(c);c.addEventListener("click",f=>{this.playPause()});c=document.createElement("div");c.className="first-frame-btn_ btn_";c.title="\u041a \u043f\u0435\u0440\u0432\u043e\u043c\u0443 \u0448\u0442\u0440\u0438\u0445\u0443";c.addEventListener("click",f=>{this.seek(0);this.updateProgress();this.player.classList.remove("finished_")});a.appendChild(c);c=document.createElement("div");c.className="speed-down-btn_ btn_";c.title="\u0423\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u044c \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c";
c.addEventListener("click",f=>{this.changeSpeed(-1)});a.appendChild(c);c=document.createElement("div");c.className="speed-up-btn_ btn_";c.title="\u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c";c.addEventListener("click",f=>{this.changeSpeed(1)});a.appendChild(c);c=document.createElement("div");c.className="last-frame-btn_ btn_";c.title="\u041a \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c\u0443 \u0448\u0442\u0440\u0438\u0445\u0443";
c.addEventListener("click",f=>{this.seek(this.data.length);this.updateProgress();this.player.classList.add("finished_")});a.appendChild(c);this.speedView=document.createElement("div");this.speedView.className="speed_";this.speedView.title="\u0422\u0435\u043a\u0443\u0449\u0430\u044f \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c";this.speedView.textContent=" ";this.updateSpeedView();a.appendChild(this.speedView);this.speedView.addEventListener("pointerdown",f=>{const {x:k,y:d}=this.player.getBoundingClientRect(),
e=(f.clientY-d-(f.clientY-f.target.getBoundingClientRect().y))/this.scaleY;this.renderSpeedInput((f.clientX-k)/this.scaleX,e);this.speedView.setPointerCapture(f.pointerId);this.speedView.addEventListener("pointermove",this.speedViewPointerMoveHandler);this.speedView.addEventListener("pointerup",h=>{this.speedView.removeEventListener("pointermove",this.speedViewPointerMoveHandler);this.speedInput?.remove()},{once:!0})});this.strokeNumView=document.createElement("div");this.strokeNumView.className=
"stroke_";this.strokeNumView.title="\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0448\u0442\u0440\u0438\u0445";this.strokeNumView.textContent=" ";this.updateStrokeView();a.appendChild(this.strokeNumView);a.appendChild(document.createElement("span"));c=document.createElement("div");c.className="expand-btn_ btn_";c.title="\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c/\u0421\u0432\u0435\u0440\u043d\u0443\u0442\u044c";c.addEventListener("click",f=>{this.expand()});a.appendChild(c);c=document.createElement("div");
c.className="fullscreen-btn_ btn_";c.title="\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043d\u0430 \u0432\u0435\u0441\u044c \u044d\u043a\u0440\u0430\u043d";c.addEventListener("click",this.toggleFullscreen);a.appendChild(c);a=document.createElement("div");a.className="close-btn_";a.title="\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u043f\u0440\u043e\u0438\u0433\u0440\u044b\u0432\u0430\u0442\u0435\u043b\u044c";a.addEventListener("click",this.terminate);this.player.appendChild(a);
this.contextLayout=document.createElement("div");this.contextLayout.className="context-layout_";this.contextLayout.addEventListener("click",this.toggleContextLayout);a=document.createElement("div");a.className="save-img-data-btn_ btn_";a.title="\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0441\u0445\u043e\u0434\u043d\u0438\u043a";a.addEventListener("click",f=>{f.stopPropagation();this.saveImageData()});this.contextLayout.appendChild(a);a=document.createElement("div");a.className=
"save-img-btn_ btn_";a.title="\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435";a.addEventListener("click",f=>{f.stopPropagation();this.saveImage()});this.contextLayout.appendChild(a);this.player.appendChild(this.contextLayout);this.container.firstElementChild.before(this.player);this.resizeHandler()}toggleContextLayout(){this.isContextMenuDisabled||(this.pause(),this.isContextLayoutShown=!this.isContextLayoutShown,this.player.classList.toggle("context-menu_",
this.isContextLayoutShown))}updateSpeedView(){let a=Number(!this.speed[0]);this.speedView.firstChild.nodeValue=`x${a?100*this.speed[a]:this.speed[a]}`}updateStrokeView(){this.strokeNumView.firstChild.nodeValue=`${this.pos} / ${this.data.length}`}resizeHandler(){const a=this.isPlaying;this.pause();if(document.fullscreenElement===this.player)this.setSize(document.documentElement.clientWidth,document.documentElement.clientHeight);else{const g=this.isExpanded?this.mainContainer:this.container;let {width:f,
height:k}=getComputedStyle(g);f=parseInt(f);k=parseInt(k);const {width:d,height:e}=this.lastContainerDimension;if(g!==this.mainContainer||f!==d||k!==e)this.setSize(f,k),this.lastContainerDimension={width:f,height:k}}a&&this.play();const {width:b,height:c}=this.mainContainer.getBoundingClientRect();this.scaleX=b/this.mainContainer.offsetWidth;this.scaleY=c/this.mainContainer.offsetHeight}getDensityByDimensions(a,b){a=Math.min(Math.ceil(a/GPTimelapsePlayer_.ORIGINAL_WIDTH),Math.ceil(b/GPTimelapsePlayer_.ORIGINAL_HEIGHT));
return{density:a,canvasWidth:GPTimelapsePlayer_.ORIGINAL_WIDTH*a,canvasHeight:GPTimelapsePlayer_.ORIGINAL_HEIGHT*a}}setSize(a,b){const {density:c,canvasWidth:g,canvasHeight:f}=this.getDensityByDimensions(a,b),{width:k,height:d}=this.calculateAspectRatioFit(GPTimelapsePlayer_.ORIGINAL_WIDTH,GPTimelapsePlayer_.ORIGINAL_HEIGHT,a,b);a=document.documentElement.style;a.setProperty("--timelapse-player-width",`${Math.round(k)}px`);a.setProperty("--timelapse-player-height",`${Math.round(d)}px`);this.density=
c;this.width=g;this.height=f;this.bgCanvas.width=g;this.bgCanvas.height=f;this.canvas.width=g;this.canvas.height=f;this.strokeCanvas.width=g;this.strokeCanvas.height=f;this.redraw()}redraw(){this.pause();if(this.background){this.clearBackground();var a=this.getCache();this.cache[this.density]?(a=a.at(-1),this.bgCtx.putImageData(a,0,0)):this.drawFunction(this.bgCtx,this.background,this.density,!1)}else this.bgCtx.fillStyle=GPTimelapsePlayer_.BACKGROUND_COLOR,this.bgCtx.fillRect(0,0,this.bgCanvas.width,
this.bgCanvas.height);this.clearCanvas();a=this.data.slice(0,this.pos);this.draw(this.ctx,a);this.clearStroke();this.stroke&&(a=this.stroke.slice(0,GPTimelapsePlayer_.STROKE_OFFSET+this.sPos+1),this.draw(this.strokeCtx,[a],this.density,!1))}calculateAspectRatioFit(a,b,c,g){c=Math.min(c/a,g/b);return{width:a*c,height:b*c}}expand(a){this.isExpanded=a??!this.isExpanded;this.player.classList.toggle("expanded_",this.isExpanded);this.isExpanded?this.mainContainer.appendChild(this.player):this.container.firstElementChild.before(this.player);
this.resizeHandler()}playPause(){this.isPlaying?this.pause():this.play()}play(a=this.pos){a||this.clearCanvas();this.isPlaying=!0;this.updateProgress();this.player.classList.add("playing_");setTimeout(()=>{this.player.classList.remove("finished_")},24);this.timer=requestAnimationFrame(this.drawing)}pause(){this.isPlaying=!1;cancelAnimationFrame(this.timer);this.player.classList.remove("playing_")}stop(){this.pause();this.pos=0;this.updateProgress()}seek(a){this.pause();a=Math.max(0,Math.min(this.data.length,
a));if(a!==this.pos||!a){this.clearStroke();if(a<this.pos||!this.pos){this.clearCanvas();var b=this.data.slice(0,a)}else b=this.data.slice(this.pos,a);this.draw(this.ctx,b);this.pos=a;this.sPos=0;this.stroke=null;this.updateStrokeView()}}drawing(){if(this.stroke)this.drawingStroke(this.stroke);else if(this.pos<this.data.length){const a=this.data.slice(this.pos,this.pos+this.speed[1]),b=a.at(-1);this.speed[0]&&[1,2].includes(b[0])?(this.sPos=0,this.stroke=b,this.drawingStroke(b)):(this.draw(this.ctx,
a),this.pos=Math.min(this.data.length,this.pos+this.speed[1]),this.pos<this.data.length?this.timer=requestAnimationFrame(this.drawing):(this.player.classList.add("finished_"),this.pause()),this.updateProgress(),this.updateStrokeView())}else this.pos=0,this.updateProgress(),this.play()}drawingStroke(a){if(this.speed[0]&&this.sPos<a.length-GPTimelapsePlayer_.STROKE_OFFSET){const b=a.slice(0,GPTimelapsePlayer_.STROKE_OFFSET+this.sPos+1);this.sPos+=this.speed[0];this.clearStroke();this.draw(this.strokeCtx,
[b],this.density,!1);this.timer=requestAnimationFrame(()=>{this.drawingStroke(a)})}else this.sPos=0,this.pos=Math.min(this.data.length,this.pos+this.speed[1]),this.clearStroke(),this.draw(this.ctx,[a]),this.updateProgress(),this.updateStrokeView(),this.stroke=null,this.pos<this.data.length?this.timer=requestAnimationFrame(this.drawing):(this.player.classList.add("finished_"),this.pause())}changeSpeed(a,b){this.currentSpeed=Math.max(0,Math.min(GPTimelapsePlayer_.SPEEDS.length-1,b??this.currentSpeed+
a));this.speed=GPTimelapsePlayer_.SPEEDS[this.currentSpeed];localStorage.setItem("gp-timelapse-player-speed",JSON.stringify(this.currentSpeed));this.updateSpeedView()}speedViewPointerMoveHandler(a){a=(a.clientX-this.player.getBoundingClientRect().x)/this.scaleX;a=Math.round(Math.max(0,Math.min(GPTimelapsePlayer_.SPEED_SLIDER_WIDTH-GPTimelapsePlayer_.SPEED_SLIDER_THUMB_WIDTH,a-this.speedInput.currentX))/((GPTimelapsePlayer_.SPEED_SLIDER_WIDTH-GPTimelapsePlayer_.SPEED_SLIDER_THUMB_WIDTH)/(GPTimelapsePlayer_.SPEEDS.length-
1)));this.speedInput.value=a;this.changeSpeed(null,a)}renderSpeedInput(a,b){if(!this.speedInput){this.speedInput=document.createElement("input");this.speedInput.className="speed-slider_";this.speedInput.type="range";this.speedInput.min=0;this.speedInput.max=GPTimelapsePlayer_.SPEEDS.length-1;this.speedInput.style.width=`${GPTimelapsePlayer_.SPEED_SLIDER_WIDTH}px`;this.speedInput.style.height=`${GPTimelapsePlayer_.SPEED_SLIDER_HEIGHT}px`;var c=GPTimelapsePlayer_.SPEEDS.findIndex(([g])=>!g);this.speedInput.style.setProperty("--bg-separator",
`${Math.round(c/GPTimelapsePlayer_.SPEEDS.length*100)+Math.round(GPTimelapsePlayer_.SPEED_SLIDER_THUMB_WIDTH/GPTimelapsePlayer_.SPEED_SLIDER_WIDTH*100)/2}%`)}this.speedInput.value=this.currentSpeed;c=(GPTimelapsePlayer_.SPEED_SLIDER_WIDTH-GPTimelapsePlayer_.SPEED_SLIDER_THUMB_WIDTH)/(GPTimelapsePlayer_.SPEEDS.length-1)*Number(this.speedInput.value);this.speedInput.style.top=`${b-GPTimelapsePlayer_.SPEED_SLIDER_HEIGHT-10}px`;this.speedInput.style.left=`${a-c-GPTimelapsePlayer_.SPEED_SLIDER_THUMB_WIDTH/
2}px`;this.player.appendChild(this.speedInput);this.speedInput.currentX=a-c}clearBackground(){this.bgCtx.fillStyle=GPTimelapsePlayer_.BACKGROUND_COLOR;this.bgCtx.fillRect(0,0,this.width,this.height)}clearCanvas(){this.ctx.clearRect(0,0,this.width,this.height)}clearStroke(){this.strokeCtx.clearRect(0,0,this.width,this.height)}updateProgress(a=this.pos){this.progress.style.width=`${Math.round(a/this.data.length*100)}%`}splitStroke(a){const [b,c,g,...f]=a;if(1===b||2===b){a=[];for(let k=1;k<=f.length;k++)a.push([b,
c,g,...f.slice(0,k)]);return a}return[a]}getCoords(a,b){b=(b||a.target).getBoundingClientRect();const [c,g]=a.touches?[a.touches[0].clientX,a.touches[0].clientY]:[a.clientX,a.clientY],[f,k]=[c-b.left,g-b.top];return[Math.round(f),Math.round(k),b.width,b.height]}progressBarPointerMoveHandler(a){const [b,,c]=this.getCoords(a);a=Math.max(0,Math.min(1,b/c));const g=Math.round(this.data.length*a);this.progress.style.width=`${100*a}%`;this.seek(g)}toggleFullscreen(){document.fullscreenElement?document.exitFullscreen():
(this.expand(!1),this.player.requestFullscreen())}saveImage(){var a=document.createElement("canvas");a.width=this.width;a.height=this.height;var b=a.getContext("2d");this.draw(b,this.data,this.density,this.eraserAlpha);b=document.createElement("canvas");b.width=this.width;b.height=this.height;var c=b.getContext("2d");c.fillStyle=GPTimelapsePlayer_.BACKGROUND_COLOR;c.fillRect(0,0,this.width,this.height);if(this.background){var g=this.getCache();this.cache[this.density]?(g=g.at(-1),c.putImageData(g,
0,0)):this.drawFunction(c,this.background,this.density,!1)}c=document.createElement("canvas");c.width=this.width;c.height=this.height;g=c.getContext("2d");g.drawImage(b,0,0,this.width,this.height);g.drawImage(a,0,0,this.width,this.height);a=this.date.toLocaleDateString("ru-RU");a=`${this.author} - ${this.title} (${a}).png`;b=document.createElement("a");b.href=c.toDataURL();b.download=a;b.click()}async saveImageData(){var a=this.date.toLocaleDateString("ru-RU");a=`${this.author} - ${this.title} (${a}).gpimg`;
var b={m:{a:this.author,t:this.title,d:this.date.toISOString()},d:this.originalData};this.background&&(b.b=this.background);this.auth&&(b.a=this.auth);b=await GPUtils_.wCompressData(b);GPUtils_.saveBlob(b,a)}getCache(){this.cache?.[this.density]||this.updateCache();return this.cache[this.density]}updateCache(){const a=this.cache||{};a[this.density]||this.worker.postMessage({type:"get-cache",density:this.density});this.cache=a}draw(a,b,c,g,f=!0){if(b){var k=GPTimelapsePlayer_.CACHE_INTERVAL;if(GPTimelapsePlayer_.CACHE_ENABLE&&
f&&b.length>k)if(f=this.getCache(),!this.cache[this.density]&&b.at(-1).index+1<k)this.drawFunction(a,b,c,g);else{const d=Math.floor((b.at(-1).index+1)/k)-1;a.putImageData(f[d],0,0);b=b.slice(-(b.at(-1).index+1-(d+1)*k));this.drawFunction(a,b,c,g)}else this.drawFunction(a,b,c,g)}}drawFunction(a,
b,c=this.density,e=this.eraserAlpha,d=!1,f=!1){f&&(a.beginPath(),a.rect(0,0,1,1),a.fill());a.lineCap=a.lineJoin="round";a.save();if(b){f=[];let H=!0,P=!1,Q=void 0;try{for(var h,l=b[Symbol.iterator]();!(H=(h=l.next()).done);H=!0){const D=h.value,E=D[0],g=(D[1],D.slice(2));if(10!=E){b=void 0;a.save();if(12==E)e?a.clearRect(0,32*c,758*c,424*c):(a.fillStyle="#FFFFFF",a.beginPath(),a.rect(0,32*c,758*c,424*c),a.fill());else if(8!=E){for(var k=1;k<g.length;k++)g[k]=[g[k][0]*c,g[k][1]*c];if(2<g.length)switch(E){case 1:var u=
g[0];a.strokeStyle=u[0];a.lineWidth=u[1];a.globalAlpha=u[2];a.lineWidth*=c;b=[g[1][0],g[1][1]];a.beginPath();a.moveTo(...b);for(k=2;k<g.length;k++){b=[g[k][0],g[k][1]];var z=[g[k-1][0],g[k-1][1]];a.quadraticCurveTo(z[0],z[1],z[0]+(b[0]-z[0])/2,z[1]+(b[1]-z[1])/2)}a.lineTo(b[0],b[1]);a.stroke();break;case 2:a.strokeStyle="#FFFFFF";a.lineWidth=g[0]*c;b=[g[1][0],g[1][1]];e&&(a.globalCompositeOperation="destination-out");a.beginPath();a.moveTo(...b);for(k=2;k<g.length;k++){b=[g[k][0],g[k][1]];var v=[g[k-
1][0],g[k-1][1]];a.quadraticCurveTo(v[0],v[1],v[0]+(b[0]-v[0])/2,v[1]+(b[1]-v[1])/2)}a.lineTo(b[0],b[1]);a.stroke();e&&(a.globalCompositeOperation="source-over");break;case 3:var A=g[0];a.strokeStyle=A[0];a.lineWidth=A[1];a.globalAlpha=A[2];a.lineWidth*=c;a.beginPath();a.moveTo(g[1][0],g[1][1]);a.lineTo(g[2][0],g[2][1]);a.stroke();break;case 4:var I=g[0];a.strokeStyle=I[0];a.lineWidth=I[1];a.globalAlpha=I[2];a.lineWidth*=c;a.beginPath();a.rect(g[1][0],g[1][1],g[2][0]-g[1][0],g[2][1]-g[1][1]);a.stroke();
break;case 6:var J=g[0];a.fillStyle=J[0];a.lineWidth=J[1];a.globalAlpha=J[2];a.lineWidth*=c;a.beginPath();a.rect(g[1][0],g[1][1],g[2][0]-g[1][0],g[2][1]-g[1][1]);a.fill();break;case 5:var K=g[0];a.strokeStyle=K[0];a.lineWidth=K[1];a.globalAlpha=K[2];a.lineWidth*=c;var w=(g[2][0]-g[1][0])/2,r=(g[2][1]-g[1][1])/2,m=Math.round(g[1][0]+w),n=Math.round(g[1][1]+r),B=(Math.sqrt(2)-1)/3*4;a.beginPath();a.moveTo(m,n-r);a.bezierCurveTo(m+B*w,n-r,m+w,n-B*r,m+w,n);a.bezierCurveTo(m+w,n+B*r,m+B*w,n+r,m,n+r);a.bezierCurveTo(m-
B*w,n+r,m-w,n+B*r,m-w,n);a.bezierCurveTo(m-w,n-B*r,m-B*w,n-r,m,n-r);a.stroke();break;case 7:var M=g[0];a.fillStyle=M[0];a.lineWidth=M[1];a.globalAlpha=M[2];a.lineWidth*=c;var x=(g[2][0]-g[1][0])/2,t=(g[2][1]-g[1][1])/2,p=Math.round(g[1][0]+x),q=Math.round(g[1][1]+t),C=(Math.sqrt(2)-1)/3*4;a.beginPath();a.moveTo(p,q-t);a.bezierCurveTo(p+C*x,q-t,p+x,q-C*t,p+x,q);a.bezierCurveTo(p+x,q+C*t,p+C*x,q+t,p,q+t);a.bezierCurveTo(p-C*x,q+t,p-x,q+C*t,p-x,q);a.bezierCurveTo(p-x,q-C*t,p-C*x,q-t,p,q-t);a.fill()}else if(![6,
7,11].includes(E)){switch(E){case 2:a.fillStyle="#FFFFFF";a.lineWidth=g[0]*c;b=g[1];e&&(a.globalCompositeOperation="destination-out");break;case 10:a.fillStyle="#FF0000";a.lineWidth=2*c;a.globalAlpha=1;b=g[1];break;default:var N=g[0];a.fillStyle=N[0];a.lineWidth=N[1];a.globalAlpha=N[2];a.lineWidth*=c;b=g[1]}a.beginPath();a.arc(b[0],b[1],a.lineWidth/2,0,2*Math.PI);a.fill();2==E&&e&&(a.globalCompositeOperation="source-over")}}else{var R=g[0];a.fillStyle=R[0];a.globalAlpha=R[1];a.beginPath();for(b=1;b<
g.length;b+=5)a.rect(g[b]*c,g[b+1]*c,g[b+2]*c,g[b+3]*c);a.fill()}a.restore()}else d&&f.push(g)}}catch(D){P=!0,Q=D}finally{try{H||null==l.return||l.return()}finally{if(P)throw Q;}}e=!0;d=!1;h=void 0;try{for(var S,O=f[Symbol.iterator]();!(e=(S=O.next()).done);e=!0){var y=S.value;for(f=1;f<y.length;f++)y[f]=[y[f][0]*c,y[f][1]*c];a.strokeStyle="#CC0053";a.lineWidth=2*c;a.globalAlpha=1;var F=[y[1][0],y[1][1]];a.beginPath();a.moveTo(...F);for(f=2;f<y.length;f++){F=[y[f][0],y[f][1]];var G=[y[f-1][0],y[f-
1][1]];a.quadraticCurveTo(G[0],G[1],G[0]+(F[0]-G[0])/2,G[1]+(F[1]-G[1])/2)}a.lineTo(F[0],F[1]);a.stroke()}}catch(D){d=!0,h=D}finally{try{e||null==O.return||O.return()}finally{if(d)throw h;}}}a.restore()}handleDelimiters(a,
b){const c=a.findLastIndex(g=>11===g[0]);if(~c){const g=a.slice(c+1);a=(b??[]).concat(a.slice(0,c).filter(f=>11!==f[0]));return[g,a,!0]}return[a,b,!1]}initCacheWorker(){let {width:a,height:b}=getComputedStyle(this.container);a=parseInt(a);b=parseInt(b);var {density:c}=this.getDensityByDimensions(a,b);let {width:g,height:f}=getComputedStyle(this.mainContainer);g=parseInt(g);f=parseInt(f);const {density:k}=this.getDensityByDimensions(g,f),{density:d}=this.getDensityByDimensions(window.screen.width,
window.screen.height),e=[...(new Set([c,k,d]))];this.worker||(c=URL.createObjectURL(new Blob([this.getFuncBody(this.cacheWorkerBody)])),this.worker=new Worker(c),URL.revokeObjectURL(c),this.worker.addEventListener("message",({data:h})=>{"worker-ready"===h.type?e.forEach(l=>{this.worker.postMessage({type:"get-cache",density:l})}):"cache-updated"===h.type&&(this.cache=h.cache,this.dispatchEvent(new CustomEvent("cache-updated",{detail:{density:h.density}})))}));this.worker.postMessage({type:"init",data:this.data,
background:this.background,eraserAlpha:this.eraserAlpha,draw:this.getFuncBody(this.drawFunction),fi:this.fi,CACHE_INTERVAL:GPTimelapsePlayer_.CACHE_INTERVAL,ORIGINAL_WIDTH:GPTimelapsePlayer_.ORIGINAL_WIDTH,ORIGINAL_HEIGHT:GPTimelapsePlayer_.ORIGINAL_HEIGHT,BACKGROUND_COLOR:GPTimelapsePlayer_.BACKGROUND_COLOR})}cacheWorkerBody(){function a(k){var d=b*k,e=c*k;if(!this.cache[k]){this.cache[k]=[];const l=f,m=Math.floor(self.data.length/l);d=new OffscreenCanvas(d,e);e=d.getContext("2d",{willReadFrequently:!0});
let n;self.background&&(e.fillStyle=g,e.fillRect(0,0,d.width,d.height),self.draw(e,this.background,k,!1),n=e.getImageData(0,0,d.width,d.height),e.clearRect(0,0,d.width,d.height));for(let p=0;p<m;p++){var h=p*l;h=self.data.slice(h,h+l);self.draw(e,h,k,self.eraserAlpha);h=e.getImageData(0,0,d.width,d.height);this.cache[k].push(h)}self.background&&this.cache[k].push(n)}}let b,c,g,f;self.data;self.draw;self.cache=[];self.addEventListener("message",({data:k})=>{"init"===k.type?(self.data=k.data,self.background=
k.background,self.eraserAlpha=k.eraserAlpha,self.fi=k.fi,self.draw=new Function("a","c","d","t","D","f",'f&&(a.beginPath(),a.rect(0,0,1,1),a.fill());a.lineCap=a.lineJoin="round";a.save();if(c){f=[];let E=!0,O=!1,P=void 0;try{for(var C,F=c[Symbol.iterator]();!(E=(C=F.next()).done);E=!0){const x=C.value,w=x[0],b=x.slice(2);if(10!=w){c=void 0;a.save();if(12==w)t?a.clearRect(0,32*d,758*d,424*d):(a.fillStyle="#FFFFFF",a.beginPath(),a.rect(0,32*d,758*d,424*d),a.fill());else if(8!=w){for(var e=1;e<b.length;e++)b[e]=[b[e][0]*d,b[e][1]*d];if(2<b.length)switch(w){case 1:var G=b[0];a.strokeStyle=G[0];a.lineWidth=G[1];a.globalAlpha=G[2];a.lineWidth*=d;c=[b[1][0],b[1][1]];a.beginPath();a.moveTo(...c);for(e=2;e<b.length;e++){c=[b[e][0],b[e][1]];var y=[b[e-1][0],b[e-1][1]];a.quadraticCurveTo(y[0],y[1],y[0]+(c[0]-y[0])/2,y[1]+(c[1]-y[1])/2)}a.lineTo(c[0],c[1]);a.stroke();break;case 2:a.strokeStyle="#FFFFFF";a.lineWidth=b[0]*d;c=[b[1][0],b[1][1]];t&&(a.globalCompositeOperation="destination-out");a.beginPath();a.moveTo(...c);for(e=2;e<b.length;e++){c=[b[e][0],b[e][1]];var z=[b[e-1][0],b[e-1][1]];a.quadraticCurveTo(z[0],z[1],z[0]+(c[0]-z[0])/2,z[1]+(c[1]-z[1])/2)}a.lineTo(c[0],c[1]);a.stroke();t&&(a.globalCompositeOperation="source-over");break;case 3:var H=b[0];a.strokeStyle=H[0];a.lineWidth=H[1];a.globalAlpha=H[2];a.lineWidth*=d;a.beginPath();a.moveTo(b[1][0],b[1][1]);a.lineTo(b[2][0],b[2][1]);a.stroke();break;case 4:var I=b[0];a.strokeStyle=I[0];a.lineWidth=I[1];a.globalAlpha=I[2];a.lineWidth*=d;a.beginPath();a.rect(b[1][0],b[1][1],b[2][0]-b[1][0],b[2][1]-b[1][1]);a.stroke();break;case 6:var J=b[0];a.fillStyle=J[0];a.lineWidth=J[1];a.globalAlpha=J[2];a.lineWidth*=d;a.beginPath();a.rect(b[1][0],b[1][1],b[2][0]-b[1][0],b[2][1]-b[1][1]);a.fill();break;case 5:var K=b[0];a.strokeStyle=K[0];a.lineWidth=K[1];a.globalAlpha=K[2];a.lineWidth*=d;var p=(b[2][0]-b[1][0])/2,m=(b[2][1]-b[1][1])/2,g=Math.round(b[1][0]+p),h=Math.round(b[1][1]+m),u=(Math.sqrt(2)-1)/3*4;a.beginPath();a.moveTo(g,h-m);a.bezierCurveTo(g+u*p,h-m,g+p,h-u*m,g+p,h);a.bezierCurveTo(g+p,h+u*m,g+u*p,h+m,g,h+m);a.bezierCurveTo(g-u*p,h+m,g-p,h+u*m,g-p,h);a.bezierCurveTo(g-p,h-u*m,g-u*p,h-m,g,h-m);a.stroke();break;case 7:var L=b[0];a.fillStyle=L[0];a.lineWidth=L[1];a.globalAlpha=L[2];a.lineWidth*=d;var q=(b[2][0]-b[1][0])/2,n=(b[2][1]-b[1][1])/2,k=Math.round(b[1][0]+q),l=Math.round(b[1][1]+n),v=(Math.sqrt(2)-1)/3*4;a.beginPath();a.moveTo(k,l-n);a.bezierCurveTo(k+v*q,l-n,k+q,l-v*n,k+q,l);a.bezierCurveTo(k+q,l+v*n,k+v*q,l+n,k,l+n);a.bezierCurveTo(k-v*q,l+n,k-q,l+v*n,k-q,l);a.bezierCurveTo(k-q,l-v*n,k-v*q,l-n,k,l-n);a.fill()}else if(![6,7,11].includes(w)){switch(w){case 2:a.fillStyle="#FFFFFF";a.lineWidth=b[0]*d;c=b[1];t&&(a.globalCompositeOperation="destination-out");break;case 10:a.fillStyle="#FF0000";a.lineWidth=2*d;a.globalAlpha=1;c=b[1];break;default:var M=b[0];a.fillStyle=M[0];a.lineWidth=M[1];a.globalAlpha=M[2];a.lineWidth*=d;c=b[1]}a.beginPath();a.arc(c[0],c[1],a.lineWidth/2,0,2*Math.PI);a.fill();2==w&&t&&(a.globalCompositeOperation="source-over")}}else{var Q=b[0];a.fillStyle=Q[0];a.globalAlpha=Q[1];a.beginPath();for(c=1;c<b.length;c+=5)a.rect(b[c]*d,b[c+1]*d,b[c+2]*d,b[c+3]*d);a.fill()}a.restore()}else D&&f.push(b)}}catch(x){O=!0,P=x}finally{try{E||null==F.return||F.return()}finally{if(O)throw P;}}t=!0;D=!1;C=void 0;try{for(var R,N=f[Symbol.iterator]();!(t=(R=N.next()).done);t=!0){var r=R.value;for(f=1;f<r.length;f++)r[f]=[r[f][0]*d,r[f][1]*d];a.strokeStyle="#CC0053";a.lineWidth=2*d;a.globalAlpha=1;var A=[r[1][0],r[1][1]];a.beginPath();a.moveTo(...A);for(f=2;f<r.length;f++){A=[r[f][0],r[f][1]];var B=[r[f-1][0],r[f-1][1]];a.quadraticCurveTo(B[0],B[1],B[0]+(A[0]-B[0])/2,B[1]+(A[1]-B[1])/2)}a.lineTo(A[0],A[1]);a.stroke()}}catch(x){D=!0,C=x}finally{try{t||null==N.return||N.return()}finally{if(D)throw C;}}}a.restore()'),
f=k.CACHE_INTERVAL,b=k.ORIGINAL_WIDTH,c=k.ORIGINAL_HEIGHT,g=k.BACKGROUND_COLOR,self.postMessage({type:"worker-ready"})):"get-cache"===k.type&&(self.cache[k.density]||a(k.density),self.postMessage({type:"cache-updated",cache:self.cache,density:k.density}))})}getFuncBody(a){a=a.toString();return a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))}}window.GPTimelapsePlayer_=GPTimelapsePlayer_;const GP_IMAGE_PROTOCOL="web+gpimg",GP_FILE_FORMAT="gpimg",URL_PATTERN=new RegExp(`^https?:\\/\\/.+\\.${GP_FILE_FORMAT}\\b\\??`,"i"),L10N={ru:{DROP_ZONE_MSG:["\u041f\u0435\u0440\u0435\u043d\u0435\u0441\u0438\u0442\u0435 \u0438\u0441\u0445\u043e\u0434\u043d\u0438\u043a \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0438\u043b\u0438","\u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0430\u0439\u043b","\u0441 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430"]},
en:{DROP_ZONE_MSG:["Drag the Process File here or","select a file","from your device"]},es:{DROP_ZONE_MSG:["Arrastre el Archivo de Proceso aqu\u00ed o","seleccione un archivo","de su dispositivo"]}},DEFAULT_LANGUAGE="en",LANGUAGE=navigator.language.split("-")[0],L=L10N[LANGUAGE]??L10N[DEFAULT_LANGUAGE];let mainContainer,playerContainer,player,playerTitle;window.addEventListener("resize",handleResize);document.addEventListener("mousedown",a=>{1===a.button&&a.preventDefault()});
document.addEventListener("source_request_complete",async({detail:{success:a,blob:b}})=>{a?(a=await GPUtils_.decompressFile(b),a=parseImageData(a),renderPlayer(a)):hideLoadingSpinner()});document.addEventListener("download_source",({detail:{url:a}})=>{URL_PATTERN.test(a)&&downloadSource(a)});
"launchQueue"in window&&"files"in LaunchParams.prototype&&launchQueue.setConsumer(async a=>{a.files.length&&(a=await a.files[0].getFile(),a=new File([a],a.name||"",{type:a.type}),isGPFile(a))&&(a=await GPUtils_.decompressFile(a),a=parseImageData(a),renderPlayer(a),history.replaceState({},document.title,location.pathname))});
document.addEventListener("paste",async a=>{a.preventDefault();if(a.clipboardData.items.length){var b=Array.from(a.clipboardData.files).find(c=>isGPFile(c));b?(a=await GPUtils_.decompressFile(b),a=parseImageData(a),renderPlayer(a)):(a=Array.from(a.clipboardData.items).find(c=>"text/plain"===c.type))&&a.getAsString(c=>{URL_PATTERN.test(c)&&downloadSource(c)})}});removeNoModMsg();render();handleResize();handleQuery();
function handleQuery(){if(location.search){const a=new Map;location.search.slice(1).split("&").forEach(c=>{const [g,f]=c.split("=");a.set(decodeURIComponent(g),decodeURIComponent(f))});let b=a.get("url");b.startsWith(`${GP_IMAGE_PROTOCOL}://`)&&(b=b.slice(GP_IMAGE_PROTOCOL.length+3));URL_PATTERN.test(b)&&downloadSource(b)}}
function render(){mainContainer=document.createElement("div");mainContainer.className="main-container";playerContainer=document.createElement("div");playerContainer.innerHTML='<div class="placeholder"></div>';playerContainer.className="player-container";mainContainer.appendChild(playerContainer);var a=document.createElement("div");a.className="drop-zone";a.dataset.lang=L10N[LANGUAGE]?LANGUAGE:DEFAULT_LANGUAGE;a.innerHTML=`<span class="label">${L.DROP_ZONE_MSG[0]} <input type="file" id="select-file" accept=".${GP_FILE_FORMAT}"><label class="select-file-label" for="select-file">${L.DROP_ZONE_MSG[1]}</label> ${L.DROP_ZONE_MSG[2]}</span>`;
mainContainer.appendChild(a);a.querySelector("#select-file").addEventListener("change",async b=>{var c=b.target.files?.[0];c&&isGPFile(c)&&(c=await GPUtils_.decompressFile(c),c=parseImageData(c),renderPlayer(c),history.replaceState({},document.title,location.pathname));b.target.value=""});a=document.documentElement;a.addEventListener("dropenter",b=>{},!0);a.addEventListener("dropleave",b=>{},!0);a.addEventListener("drop",async b=>{b.preventDefault();if(b.dataTransfer.items.length){var c=Array.from(b.dataTransfer.files).find(g=>
isGPFile(g));c?(b=await GPUtils_.decompressFile(c),b=parseImageData(b),renderPlayer(b),history.replaceState({},document.title,location.pathname)):(b=Array.from(b.dataTransfer.items).find(g=>"text/uri-list"===g.type))&&b.getAsString(g=>{URL_PATTERN.test(g)&&downloadSource(g)})}},!0);a.addEventListener("dragover",b=>{b.preventDefault();b.dataTransfer.dropEffect="move"},!0);playerTitle=document.createElement("div");playerTitle.className="title";mainContainer.appendChild(playerTitle);document.body.appendChild(mainContainer)}
function renderPlayer({background:a,data:b,auth:c,meta:{author:g,title:f,date:k}}){GPTimelapsePlayer_.closeAll();mainContainer.classList.add("player");clearTitle();showLoadingSpinner();player=new GPTimelapsePlayer_({image:{data:b,background:a,auth:c,meta:{author:g,title:f,date:k}},container:playerContainer,mainContainer});player.addEventListener("data-loaded",({detail:{author:d,title:e,date:h}})=>{setTitle(d,e,h)});player.addEventListener("image-rendered",d=>{hideLoadingSpinner()},{once:!0});player.addEventListener("terminated",
d=>{mainContainer.classList.remove("player");clearTitle()},{once:!0})}function handleResize(a){mainContainer.style.transform=`scale(${getScale()})`}function getScale(){let a=(window.innerWidth-180)/1150;766*a>window.innerHeight&&(a=window.innerHeight/766);return Math.min(1,a)}function isGPFile(a){return a.name.toLowerCase().endsWith(`.${GP_FILE_FORMAT}`)}function downloadSource(a){document.dispatchEvent(new CustomEvent("source_request",{detail:{url:a}}));showLoadingSpinner()}
function parseImageData(a){const {b,d:c,a:g,m:{a:f,t:k,d}}=a;return{background:b,data:c,auth:g,meta:{author:f,title:k,date:d}}}function showLoadingSpinner(){document.documentElement.classList.add("loading")}function hideLoadingSpinner(){document.documentElement.classList.remove("loading")}function removeNoModMsg(){const a=document.getElementById("no-mod");a&&a.remove()}
function setTitle(a,b,c){c=(new Date(c)).toLocaleDateString("default",{year:"numeric",month:"long",day:"numeric"});a=`${a} - ${b} (${c})`;playerTitle.textContent=a;playerTitle.title=a}function clearTitle(){playerTitle.textContent="";playerTitle.title=""};
}).call(this)
